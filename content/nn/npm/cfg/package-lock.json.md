+++
title = "package-lock.json"
date = 2024-10-06T17:13:30+08:00
weight = 60
type = "docs"
description = ""
isCJKLanguage = true
draft = false
+++

> 原文：[https://docs.npmjs.com/cli/v10/configuring-npm/package-lock-json](https://docs.npmjs.com/cli/v10/configuring-npm/package-lock-json)

A manifestation of the manifest

​	`package-lock.json` 的作用与用法

Version 10.9.0 (Latest)

## Description

`package-lock.json` is automatically generated for any operations where npm modifies either the `node_modules` tree, or `package.json`. It describes the exact tree that was generated, such that subsequent installs are able to generate identical trees, regardless of intermediate dependency updates.

​	`package-lock.json` 是在 npm 修改 `node_modules` 目录或 `package.json` 文件时自动生成的文件。它描述了生成的依赖树结构，从而确保后续安装操作能够生成相同的依赖树结构，不受中间依赖项更新的影响。

This file is intended to be committed into source repositories, and serves various purposes:

​	此文件应提交到源代码仓库中，并且具有以下多种用途：

- Describe a single representation of a dependency tree such that teammates, deployments, and continuous integration are guaranteed to install exactly the same dependencies.
- 描述依赖树的单一表示形式，以确保团队成员、部署和持续集成环境能够安装完全相同的依赖项。

- Provide a facility for users to "time-travel" to previous states of `node_modules` without having to commit the directory itself.
- 为用户提供“时间旅行”的能力，可以回到 `node_modules` 的某个先前状态，而无需提交整个 `node_modules` 目录。
- Facilitate greater visibility of tree changes through readable source control diffs.
- 通过可读的源代码控制差异（diffs）提高对依赖树变更的可见性。
- Optimize the installation process by allowing npm to skip repeated metadata resolutions for previously-installed packages.
- 优化安装过程，使 npm 可以跳过已安装包的重复元数据解析。
- As of npm v7, lockfiles include enough information to gain a complete picture of the package tree, reducing the need to read `package.json` files, and allowing for significant performance improvements.
- 从 npm v7 开始，锁定文件（lockfiles）包含足够的信息来描述整个包的依赖树，从而减少读取 `package.json` 文件的需求，并显著提升性能。

When `npm` creates or updates `package-lock.json`, it will infer line endings and indentation from `package.json` so that the formatting of both files matches.

​	当 `npm` 创建或更新 `package-lock.json` 时，它会从 `package.json` 中推断行结束符和缩进格式，以便两个文件的格式一致。

## `package-lock.json` vs `npm-shrinkwrap.json`

Both of these files have the same format, and perform similar functions in the root of a project.

​	这两个文件的格式相同，在项目根目录中功能也类似。

The difference is that `package-lock.json` cannot be published, and it will be ignored if found in any place other than the root project.

​	区别在于 `package-lock.json` 不能被发布，并且如果出现在根项目以外的位置时将被忽略。

In contrast, [npm-shrinkwrap.json](https://docs.npmjs.com/cli/v10/configuring-npm/npm-shrinkwrap-json) allows publication, and defines the dependency tree from the point encountered. This is not recommended unless deploying a CLI tool or otherwise using the publication process for producing production packages.

​	相比之下，[npm-shrinkwrap.json](https://docs.npmjs.com/cli/v10/configuring-npm/npm-shrinkwrap-json) 允许发布，并且定义从当前状态开始的依赖树。除非是为了部署 CLI 工具或通过发布流程来生成生产包，否则不推荐使用 `npm-shrinkwrap.json`。

If both `package-lock.json` and `npm-shrinkwrap.json` are present in the root of a project, `npm-shrinkwrap.json` will take precedence and `package-lock.json` will be ignored.

​	如果在项目根目录中同时存在 `package-lock.json` 和 `npm-shrinkwrap.json` 文件，`npm-shrinkwrap.json` 将优先使用，而 `package-lock.json` 会被忽略。

## 隐藏锁定文件 Hidden Lockfiles

In order to avoid processing the `node_modules` folder repeatedly, npm as of v7 uses a "hidden" lockfile present in `node_modules/.package-lock.json`. This contains information about the tree, and is used in lieu of reading the entire `node_modules` hierarchy provided that the following conditions are met:

​	为了避免重复处理 `node_modules` 文件夹，从 npm v7 开始，npm 使用 `node_modules/.package-lock.json` 中的“隐藏”锁定文件。此文件包含有关依赖树的信息，只要满足以下条件，它就可以替代读取整个 `node_modules` 层级：

- All package folders it references exist in the `node_modules` hierarchy.
- 它引用的所有包文件夹都存在于 `node_modules` 层级中。

- No package folders exist in the `node_modules` hierarchy that are not listed in the lockfile.
- `node_modules` 层级中不存在锁定文件中未列出的包文件夹。
- The modified time of the file is at least as recent as all of the package folders it references.
- 该文件的修改时间不早于它所引用的所有包文件夹的修改时间。

That is, the hidden lockfile will only be relevant if it was created as part of the most recent update to the package tree. If another CLI mutates the tree in any way, this will be detected, and the hidden lockfile will be ignored.

​	即，隐藏锁定文件只有在作为依赖树的最新更新的一部分创建时才有效。如果有其他 CLI 工具以任何方式更改了依赖树，该文件将被忽略。

Note that it *is* possible to manually change the *contents* of a package in such a way that the modified time of the package folder is unaffected. For example, if you add a file to `node_modules/foo/lib/bar.js`, then the modified time on `node_modules/foo` will not reflect this change. If you are manually editing files in `node_modules`, it is generally best to delete the file at `node_modules/.package-lock.json`.

​	注意，可以手动更改包的内容而不影响包文件夹的修改时间。例如，如果您在 `node_modules/foo/lib/bar.js` 中添加了一个文件，则 `node_modules/foo` 的修改时间不会反映此更改。如果您手动编辑了 `node_modules` 中的文件，通常最好删除 `node_modules/.package-lock.json` 文件。

As the hidden lockfile is ignored by older npm versions, it does not contain the backwards compatibility affordances present in "normal" lockfiles. That is, it is `lockfileVersion: 3`, rather than `lockfileVersion: 2`.

​	由于隐藏锁定文件被旧版本 npm 忽略，因此它不包含在“常规”锁定文件中的向后兼容内容。因此，它的 `lockfileVersion` 为 3，而不是 2。



## 处理旧锁定文件 Handling Old Lockfiles

When npm detects a lockfile from npm v6 or before during the package installation process, it is automatically updated to fetch missing information from either the `node_modules` tree or (in the case of empty `node_modules` trees or very old lockfile formats) the npm registry.

​	当 npm 在安装过程中检测到 npm v6 或更早版本的锁定文件时，会自动更新以从 `node_modules` 树中（或在 `node_modules` 为空时从 npm 注册表中）获取缺失信息。

## 文件格式 File Format

### `name`

The name of the package this is a package-lock for. This will match what's in `package.json`.

​	此字段表示该文件所对应的包的名称，与 `package.json` 中的内容一致。

### `version`

The version of the package this is a package-lock for. This will match what's in `package.json`.

​	此字段表示该文件所对应的包的版本号，与 `package.json` 中的内容一致。

### `lockfileVersion`

An integer version, starting at `1` with the version number of this document whose semantics were used when generating this `package-lock.json`.

​	这是一个整数，表示使用生成此 `package-lock.json` 文件时所使用的文件格式版本号，从 `1` 开始。

Note that the file format changed significantly in npm v7 to track information that would have otherwise required looking in `node_modules` or the npm registry. Lockfiles generated by npm v7 will contain `lockfileVersion: 2`.

​	需要注意的是，文件格式在 npm v7 中发生了重大变化，以便跟踪那些原本需要从 `node_modules` 或 npm 注册表中查找的信息。npm v7 生成的锁定文件将包含 `lockfileVersion: 2`。

- No version provided: an "ancient" shrinkwrap file from a version of npm prior to npm v5.
- 没有提供版本号：表示一个来自 npm v5 之前版本的“古老” shrinkwrap 文件。

- `1`: The lockfile version used by npm v5 and v6. 由 npm v5 和 v6 使用的锁定文件版本。
- `2`: The lockfile version used by npm v7 and v8. Backwards compatible to v1 lockfiles. 由 npm v7 和 v8 使用的锁定文件版本，向后兼容 v1 的锁定文件。
- `3`: The lockfile version used by npm v9 and above. Backwards compatible to npm v7. 由 npm v9 及更高版本使用的锁定文件版本，向后兼容 npm v7 的锁定文件。

npm will always attempt to get whatever data it can out of a lockfile, even if it is not a version that it was designed to support.

​	npm 会尽量从锁定文件中获取所有可用数据，即使它不是 npm 设计支持的版本。

### `packages`

This is an object that maps package locations to an object containing the information about that package.

​	这是一个对象，将包位置映射到包含该包信息的对象中。

The root project is typically listed with a key of `""`, and all other packages are listed with their relative paths from the root project folder.

​	根项目通常使用 `""` 作为键，所有其他包则使用相对于根项目文件夹的相对路径列出。

Package descriptors have the following fields:

​	包描述对象包含以下字段：

- version: The version found in `package.json`
- `version`：在 `package.json` 中找到的版本号。

- resolved: The place where the package was actually resolved from. In the case of packages fetched from the registry, this will be a url to a tarball. In the case of git dependencies, this will be the full git url with commit sha. In the case of link dependencies, this will be the location of the link target. `registry.npmjs.org` is a magic value meaning "the currently configured registry".
- `resolved`：表示该包实际解析自何处。对于从注册表获取的包，这将是一个指向 tarball 的 URL。对于 git 依赖项，这将是包含提交 SHA 的完整 git URL。对于链接依赖项，这将是链接目标的位置。`registry.npmjs.org` 是一个特殊值，表示“当前配置的注册表”。
- integrity: A `sha512` or `sha1` [Standard Subresource Integrity](https://w3c.github.io/webappsec/specs/subresourceintegrity/) string for the artifact that was unpacked in this location.
- `integrity`：用于在该位置解包的文件的 `sha512` 或 `sha1` [标准子资源完整性](https://w3c.github.io/webappsec/specs/subresourceintegrity/) 字符串。
- link: A flag to indicate that this is a symbolic link. If this is present, no other fields are specified, since the link target will also be included in the lockfile.
- `link`：表示这是一个符号链接的标志。如果存在此字段，则不会指定其他字段，因为链接目标也会包含在锁定文件中。
- dev, optional, devOptional: If the package is strictly part of the `devDependencies` tree, then `dev` will be true. If it is strictly part of the `optionalDependencies` tree, then `optional` will be set. If it is both a `dev` dependency *and* an `optional` dependency of a non-dev dependency, then `devOptional` will be set. (An `optional` dependency of a `dev` dependency will have both `dev` and `optional` set.)
- `dev, optional, devOptional`：如果包严格是 `devDependencies` 树的一部分，则 `dev` 为 true。如果它严格是 `optionalDependencies` 树的一部分，则 `optional` 为 true。如果它既是 `dev` 依赖项又是非开发依赖项的 `optional` 依赖项，则 `devOptional` 为 true。(`dev` 依赖项的 `optional` 依赖项同时具有 `dev` 和 `optional` 属性。)
- inBundle: A flag to indicate that the package is a bundled dependency.
- `inBundle`：表示该包是捆绑依赖项的标志。
- hasInstallScript: A flag to indicate that the package has a `preinstall`, `install`, or `postinstall` script.
- `hasInstallScript`：表示该包具有 `preinstall`、`install` 或 `postinstall` 脚本的标志。
- hasShrinkwrap: A flag to indicate that the package has an `npm-shrinkwrap.json` file.
- `hasShrinkwrap`：表示该包具有 `npm-shrinkwrap.json` 文件的标志。
- bin, license, engines, dependencies, optionalDependencies: fields from `package.json`
- `bin, license, engines, dependencies, optionalDependencies`：来自 `package.json` 的字段。

### dependencies

Legacy data for supporting versions of npm that use `lockfileVersion: 1`. This is a mapping of package names to dependency objects. Because the object structure is strictly hierarchical, symbolic link dependencies are somewhat challenging to represent in some cases.

​	这是用于支持使用 `lockfileVersion: 1` 的 npm 版本的旧数据。它是将包名称映射到依赖对象的映射。由于对象结构严格分层，因此在某些情况下，符号链接依赖项可能很难表示。

npm v7 ignores this section entirely if a `packages` section is present, but does keep it up to date in order to support switching between npm v6 and npm v7.

​	如果存在 `packages` 部分，npm v7 将完全忽略该部分，但会保持其最新状态以支持在 npm v6 和 npm v7 之间切换。

Dependency objects have the following fields:

​	依赖对象具有以下字段：

- version: a specifier that varies depending on the nature of the package, and is usable in fetching a new copy of it.
- `version`：一个取决于包性质的规范，用于获取它的新副本。
  - bundled dependencies: Regardless of source, this is a version number that is purely for informational purposes.
  - 捆绑依赖项：无论来源如何，这只是一个纯信息用途的版本号。
  - registry sources: This is a version number. (eg, `1.2.3`)
  - 注册表来源：这是一个版本号（例如，`1.2.3`）。
  - git sources: This is a git specifier with resolved committish. (eg, `git+https://example.com/foo/bar#115311855adb0789a0466714ed48a1499ffea97e`)
  - git 来源：这是一个带有提交 SHA 的 git 规范（例如，`git+https://example.com/foo/bar#115311855adb0789a0466714ed48a1499ffea97e`）。
  - http tarball sources: This is the URL of the tarball. (eg, `https://example.com/example-1.3.0.tgz`)
  - HTTP tarball 来源：这是 tarball 的 URL（例如，`https://example.com/example-1.3.0.tgz`）。
  - local tarball sources: This is the file URL of the tarball. (eg `file:///opt/storage/example-1.3.0.tgz`)
  - 本地 tarball 来源：这是 tarball 的文件 URL（例如，`file:///opt/storage/example-1.3.0.tgz`）。
  - local link sources: This is the file URL of the link. (eg `file:libs/our-module`)
  - 本地链接来源：这是链接的文件 URL（例如，`file:libs/our-module`）。

- integrity: A `sha512` or `sha1` [Standard Subresource Integrity](https://w3c.github.io/webappsec/specs/subresourceintegrity/) string for the artifact that was unpacked in this location. For git dependencies, this is the commit sha.
- `integrity`：在该位置解包的文件的 `sha512` 或 `sha1` [标准子资源完整性](https://w3c.github.io/webappsec/specs/subresourceintegrity/) 字符串。对于 git 依赖项，此字段表示提交 SHA。
- resolved: For registry sources this is path of the tarball relative to the registry URL. If the tarball URL isn't on the same server as the registry URL then this is a complete URL. `registry.npmjs.org` is a magic value meaning "the currently configured registry".
- `resolved`：对于注册表来源，这表示相对于注册表 URL 的 tarball 路径。如果 tarball URL 不在与注册表 URL 相同的服务器上，则它是一个完整的 URL。`registry.npmjs.org` 是一个特殊值，表示“当前配置的注册表”。
- bundled: If true, this is the bundled dependency and will be installed by the parent module. When installing, this module will be extracted from the parent module during the extract phase, not installed as a separate dependency.
- `bundled`：如果为 true，则表示这是捆绑依赖项，将由父模块安装。在安装时，该模块将在解压阶段从父模块中提取，而不是作为单独的依赖项进行安装。
- dev: If true then this dependency is either a development dependency ONLY of the top level module or a transitive dependency of one. This is false for dependencies that are both a development dependency of the top level and a transitive dependency of a non-development dependency of the top level.
- `dev`：如果为 true，则表示该依赖项仅是顶级模块的开发依赖项或其传递依赖项。对于同时是顶级模块开发依赖项和顶级模块的非开发依赖项的传递依赖项的依赖项，此字段为 false。
- optional: If true then this dependency is either an optional dependency ONLY of the top level module or a transitive dependency of one. This is false for dependencies that are both an optional dependency of the top level and a transitive dependency of a non-optional dependency of the top level.
- `optional`：如果为 true，则表示该依赖项仅是顶级模块的可选依赖项或其传递依赖项。对于同时是顶级模块的可选依赖项和顶级模块的非可选依赖项的传递依赖项的依赖项，此字段为 false。
- requires: This is a mapping of module name to version. This is a list of everything this module requires, regardless of where it will be installed. The version should match via normal matching rules a dependency either in our `dependencies` or in a level higher than us.
- `requires`：这是模块名称与版本的映射。它是该模块所需的所有依赖项的列表，而不论它将被安装在哪里。版本应通过正常匹配规则与我们的 `dependencies` 或比我们更高层级的依赖项相匹配。
- dependencies: The dependencies of this dependency, exactly as at the top level.
- `dependencies`：该依赖项的依赖项，与顶级的依赖项完全一致。

## See also

- [npm shrinkwrap](https://docs.npmjs.com/cli/v10/commands/npm-shrinkwrap)
- [npm-shrinkwrap.json](https://docs.npmjs.com/cli/v10/configuring-npm/npm-shrinkwrap-json)
- [package.json](https://docs.npmjs.com/cli/v10/configuring-npm/package-json)
- [npm install](https://docs.npmjs.com/cli/v10/commands/npm-install)